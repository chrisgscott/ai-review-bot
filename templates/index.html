{% extends "base_public.html" %}
{% block title %}
    {% if business_name %}
        Leave Some Love For {{ business_name }}
    {% else %}
        Share Your Experience
    {% endif %}
{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold mb-6 text-center">
    {% if business_name %}
        Leave Some Love for {{ business_name }}
    {% else %}
        Share Your Experience
    {% endif %}
</h1>

<div id="chatbot" class="bg-base-200 rounded-lg p-6" data-first-name="{{ first_name }}" data-email="{{ email }}">
    <div id="messages" class="mb-4 h-64 overflow-y-auto"></div>

    <div id="input-area" class="flex mb-4" style="display: none;">
        <textarea id="user-input" class="textarea textarea-bordered flex-grow mr-2" placeholder="Type your message..." rows="1"></textarea>
        <button onclick="sendMessage()" class="btn btn-primary">Send</button>
    </div>

    <div id="action-buttons" class="hidden mb-4">
        <button onclick="getNextQuestion()" class="btn btn-secondary mr-2">Continue Chatting</button>
    </div>
    
    <button id="submit-testimonial" onclick="submitTestimonial()" class="btn btn-primary w-full hidden">Submit Testimonial</button>
</div>

<style>
    #user-input {
        min-height: 2.5rem;
        max-height: 150px;
        resize: none;
        overflow-y: auto;
    }
</style>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='chatbot.js') }}"></script>
<script>
    const businessId = "{{ business_id }}";
    {% if unique_id %}
    const uniqueId = "{{ unique_id }}";
    {% endif %}

    document.addEventListener('DOMContentLoaded', function() {
        const textarea = document.getElementById('user-input');

        function autoResize() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        }

        textarea.addEventListener('input', autoResize);

        textarea.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Initial call to set the correct height
        autoResize.call(textarea);
    });
</script>
{% endblock %}